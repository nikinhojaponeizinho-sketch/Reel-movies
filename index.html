<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reel Evolution v3</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #e50914; --bg: #050505; --premium: #ffbb00; --text: #fff; --glass: rgba(255, 255, 255, 0.08); }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* Sistema de Telas */
        .tela { display: none; min-height: 100vh; width: 100vw; flex-direction: column; align-items: center; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .tela.ativa { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(1.02); } to { opacity: 1; transform: scale(1); } }

        /* Estilo Vidro Premium */
        .glass { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; }

        /* BOTÃO "+" REESTILIZADO */
        .btn-novo-perfil {
            width: 130px; height: 130px; 
            border: 2px dashed #444; border-radius: 20%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 50px; color: #666; cursor: pointer; transition: 0.3s;
            margin-bottom: 25px;
        }
        .btn-novo-perfil:active { transform: scale(0.9); border-color: var(--primary); color: var(--primary); }

        .perfil-img { 
            width: 130px; height: 130px; background: linear-gradient(45deg, #1a1a1a, #333); 
            border-radius: 20%; border: 3px solid transparent; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 55px; color: white; transition: 0.3s;
        }
        .perfil-card:active .perfil-img { border-color: var(--primary); transform: scale(0.95); }

        /* BUSCA FLUTUANTE */
        .search-box {
            width: 90%; max-width: 500px; margin: 20px 0;
            display: flex; align-items: center; background: var(--glass);
            border-radius: 15px; padding: 5px 15px; border: 1px solid rgba(255,255,255,0.05);
        }
        .search-box input { background: none; border: none; color: white; padding: 12px; width: 100%; outline: none; font-size: 16px; }

        /* PLAYER CINEMATOGRÁFICO */
        #t-player { background: #000; position: fixed; inset: 0; z-index: 10000; }
        .player-header { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); z-index: 10; display: flex; align-items: center; }
        .video-container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }

        /* GRID DE FILMES */
        .row-items { display: flex; gap: 12px; overflow-x: auto; padding: 10px 5%; scrollbar-width: none; }
        .row-items::-webkit-scrollbar { display: none; }
        .filme-card { min-width: 130px; height: 190px; background: #111; border-radius: 12px; overflow: hidden; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .filme-card img { width: 100%; height: 100%; object-fit: cover; }

        /* BOTÕES */
        .btn-main { background: var(--primary); color: white; padding: 16px; border: none; border-radius: 15px; width: 100%; font-weight: bold; cursor: pointer; font-size: 15px; transition: 0.2s; }
        .btn-main:active { opacity: 0.8; transform: scale(0.98); }
        
        textarea { width: 100%; height: 120px; background: rgba(0,0,0,0.3); border: 1px solid #333; color: #00ff00; font-family: monospace; padding: 10px; border-radius: 10px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="t-perfis" class="tela ativa">
        <h1 style="margin-top:80px; font-size: 28px; letter-spacing: 2px;">REEL<span style="color:var(--primary)">EVOLUTION</span></h1>
        <div id="lista-p" style="display:flex; gap:20px; margin-top:50px; flex-wrap: wrap; justify-content: center; padding: 0 20px;"></div>
        <button class="glass" onclick="ir('t-sync')" style="margin-top:60px; padding: 12px 30px; color:#aaa; font-size:12px; cursor:pointer; border:none;">SINCRONIZAR DADOS</button>
        <div onclick="ir('t-adm-login')" style="position:fixed; bottom:20px; color:#1a1a1a; font-size:10px;">CONFIG</div>
    </div>

    <div id="t-home" class="tela">
        <div style="width:90%; display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
            <div style="line-height:1.2"><small style="color:#666">Perfil</small><br><b id="user-n"></b></div>
            <button onclick="ir('t-plano')" style="background:var(--premium); border:none; padding:8px 15px; border-radius:10px; font-weight:bold; font-size:12px;">ATIVAR PREMIUM</button>
        </div>

        <div class="search-box">
            <input type="text" id="busca" placeholder="O que vamos assistir hoje?" oninput="renderHome(this.value)">
        </div>

        <div id="container-rows" style="width:100%; margin-bottom: 50px;"></div>
    </div>

    <div id="t-player" class="tela">
        <div class="player-header">
            <button onclick="fecharPlayer()" style="background:rgba(255,255,255,0.1); border:none; color:white; padding:10px 20px; border-radius:10px; font-weight:bold;">← VOLTAR</button>
            <span id="video-titulo" style="margin-left:20px; font-weight:bold; font-size:14px; color:#eee;"></span>
        </div>
        <div class="video-container" id="video-content"></div>
    </div>

    <div id="t-adm-painel" class="tela">
        <div class="glass" style="padding:25px; width:85%; max-width:400px; margin-top:40px;">
            <h3 style="margin-top:0">Novo Filme</h3>
            <input type="text" id="f-tit" placeholder="Título">
            <input type="text" id="f-url" placeholder="Link/ID Drive">
            <input type="text" id="f-capa" placeholder="URL da Capa">
            <select id="f-cat">
                <option value="Lançamentos">Lançamentos</option>
                <option value="Ação">Ação</option>
                <option value="Terror">Terror</option>
                <option value="Séries">Séries</option>
            </select>
            <button onclick="addF()" class="btn-main">SALVAR NO DISPOSITIVO</button>
            <hr style="border:0; border-top:1px solid #222; margin:20px 0;">
            <button onclick="copiarSyncSuperCurto()" class="btn-main" style="background:#007bff;">GERAR CÓDIGO ULTRA CURTO</button>
            <button onclick="ir('t-perfis')" style="background:none; border:none; color:#666; width:100%; margin-top:15px;">SAIR</button>
        </div>
    </div>

    <div id="t-sync" class="tela">
        <div class="glass" style="padding:25px; width:85%; max-width:320px; margin-top:100px;">
            <h3>Sincronizar</h3>
            <textarea id="input-sync" placeholder="Cole o código aqui..."></textarea>
            <button onclick="importarSuperCurto()" class="btn-main" style="margin-top:15px;">ATUALIZAR CATÁLOGO</button>
            <button onclick="ir('t-perfis')" style="background:none; border:none; color:#666; width:100%; margin-top:15px;">CANCELAR</button>
        </div>
    </div>

    <div id="t-adm-login" class="tela">
        <div class="glass" style="padding:30px; margin-top:100px;">
            <input type="password" id="pass-adm" placeholder="Senha ADM">
            <button onclick="loginAdm()" class="btn-main">ENTRAR</button>
        </div>
    </div>

    <div id="t-plano" class="tela">
        <div class="glass" style="padding:30px; margin-top:100px; text-align:center; width:80%;">
            <h2 style="color:var(--premium)">Premium</h2>
            <p style="color:#666; font-size:13px;">Insira a chave REEL para liberar o acesso total.</p>
            <input type="text" id="chave-input" placeholder="REEL-XXXX">
            <button onclick="ativarChave()" class="btn-main">ATIVAR ACESSO</button>
            <button onclick="ir('t-home')" style="background:none; border:none; color:#666; margin-top:15px;">VOLTAR</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('reel_v30')) || [];
        let user = null;

        function ir(id) {
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
            document.getElementById(id).classList.add('ativa');
            if(id === 't-perfis') renderPerfis();
            if(id === 't-home') renderHome();
            window.scrollTo(0,0);
        }

        function renderPerfis() {
            const cont = document.getElementById('lista-p');
            cont.innerHTML = '';
            Object.keys(localStorage).forEach(k => {
                if(k.startsWith('per_v30_')) {
                    let p = JSON.parse(localStorage.getItem(k));
                    let d = document.createElement('div');
                    d.className = 'perfil-card';
                    d.innerHTML = `<div class="perfil-img">${p.nome[0].toUpperCase()}</div><p style="font-size:14px; font-weight:bold; margin-top:8px;">${p.nome}</p>`;
                    d.onclick = () => { user = p; ir('t-home'); };
                    cont.appendChild(d);
                }
            });
            let add = document.createElement('div');
            add.className = 'btn-novo-perfil';
            add.innerHTML = '+';
            add.onclick = () => { 
                let n = prompt("Nome:"); 
                if(n){ let id='per_v30_'+Date.now(); localStorage.setItem(id, JSON.stringify({id, nome:n, expira:0})); renderPerfis(); }
            };
            cont.appendChild(add);
        }

        function renderHome(f = "") {
            document.getElementById('user-n').innerText = user.nome;
            const exp = user.expira > Date.now();
            const cont = document.getElementById('container-rows');
            cont.innerHTML = '';
            
            const filtrados = db.filter(i => i.t.toLowerCase().includes(f.toLowerCase()));
            const cats = [...new Set(filtrados.map(i => i.c))];

            cats.forEach(cat => {
                let div = document.createElement('div');
                div.innerHTML = `<h4 style="margin:20px 5% 10px 5%; color:#888; font-size:13px; text-transform:uppercase;">${cat}</h4><div class="row-items"></div>`;
                filtrados.filter(i => i.c === cat).forEach(item => {
                    let card = document.createElement('div');
                    card.className = 'filme-card';
                    card.innerHTML = `<img src="${item.i}">`;
                    card.onclick = () => { if(exp) abrir(item); else ir('t-plano'); };
                    div.querySelector('.row-items').appendChild(card);
                });
                cont.appendChild(div);
            });
        }

        function abrir(item) {
            ir('t-player');
            document.getElementById('video-titulo').innerText = item.t;
            const vid = item.u.length > 20 ? item.u.match(/[-\w]{25,}/)[0] : item.u;
            document.getElementById('video-content').innerHTML = `<iframe src="https://drive.google.com/file/d/${vid}/preview" allow="autoplay; fullscreen" sandbox="allow-forms allow-scripts allow-same-origin allow-top-navigation" allowfullscreen></iframe>`;
        }

        function fecharPlayer() { document.getElementById('video-content').innerHTML = ''; ir('t-home'); }

        function loginAdm() { if(['Nicolas','Yudi'].includes(document.getElementById('pass-adm').value)) ir('t-adm-painel'); }

        function addF() {
            const t=document.getElementById('f-tit').value, u=document.getElementById('f-url').value, i=document.getElementById('f-capa').value, c=document.getElementById('f-cat').value;
            if(t&&u){ db.push({t, u, i, c}); localStorage.setItem('reel_v30', JSON.stringify(db)); alert("Salvo!"); }
        }

        // --- SISTEMA DE SINCRONIZAÇÃO ULTRA CURTO ---
        function copiarSyncSuperCurto() {
            // Simplifica os dados para carregar menos texto
            const compact = db.map(f => {
                const id = f.u.match(/[-\w]{25,}/);
                return [f.t, id ? id[0] : f.u, f.i, f.c];
            });
            const hash = btoa(unescape(encodeURIComponent(JSON.stringify(compact))));
            navigator.clipboard.writeText(hash);
            alert("Código Ultra Curto Copiado!");
        }

        function importarSuperCurto() {
            try {
                const hash = document.getElementById('input-sync').value;
                const raw = JSON.parse(decodeURIComponent(escape(atob(hash))));
                db = raw.map(f => ({ t: f[0], u: f[1], i: f[2], c: f[3] }));
                localStorage.setItem('reel_v30', JSON.stringify(db));
                alert("Sincronizado!"); ir('t-perfis');
            } catch(e) { alert("Código inválido!"); }
        }

        function ativarChave() {
            if(document.getElementById('chave-input').value.includes("REEL")){
                user.expira = Date.now() + 2592000000;
                localStorage.setItem(user.id, JSON.stringify(user));
                confetti({ particleCount:150, spread:70, origin:{y:0.6} });
                alert("PREMIUM ATIVADO!"); ir('t-home');
            }
        }

        renderPerfis();
    </script>
</body>
</html>
